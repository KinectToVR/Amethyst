Invoke-WebRequest -Uri 'https://github.com/microsoft/vswhere/releases/latest/download/vswhere.exe' -OutFile './vswhere.exe'
$msbuild = "$("$(.\vswhere.exe -legacy -prerelease -products * -format json | Select-String -Pattern "2022" | `
     Select-String -Pattern "Studio" | Select-Object -First 1 | Select-String -Pattern "installationPath")" `
    -replace('"installationPath": "','') -replace('",',''))".Trim() + "\\MSBuild\\Current\\Bin\\MSBuild.exe"

&"$msbuild" KinectToVR.sln /t:restore "/p:Configuration=Release;Platform=x64;RestorePackagesConfig=true"

&"$msbuild" KinectToVR.sln /t:device_KinectV1 "/p:Configuration=Release;Platform=x64;BuildInParallel=true"
&"$msbuild" KinectToVR.sln /t:device_KinectV2 "/p:Configuration=Release;Platform=x64;BuildInParallel=true"
&"$msbuild" KinectToVR.sln /t:device_PSMoveService "/p:Configuration=Release;Platform=x64;BuildInParallel=true"

&"$msbuild" KinectToVR.sln /t:driver_KinectToVR "/p:Configuration=Release;Platform=x64;BuildInParallel=true"

&"$msbuild" KinectToVR.sln "/m:5" "/p:Configuration=Release;Platform=x64;BuildInParallel=true"